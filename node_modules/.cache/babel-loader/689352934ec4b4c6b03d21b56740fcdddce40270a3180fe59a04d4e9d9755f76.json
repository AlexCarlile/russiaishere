{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Modal,Button}from'antd';import{CampaignForm}from'./CampaignForm';import axios from'axios';import Cookies from'js-cookie';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export const Campaigns=()=>{const[isModalVisible,setIsModalVisible]=useState(false);const[campaigns,setCampaigns]=useState([]);const[user,setUser]=useState(null);const fetchCampaigns=async()=>{try{const token=Cookies.get('token');const response=await axios.get('http://127.0.0.1:5000/user',{headers:{'Authorization':\"Bearer \".concat(token)}});setUser(response.data);// Здесь устанавливаем данные о пользователе\n}catch(error){console.error('Failed to fetch user:',error);}try{const token=Cookies.get('token');const response=await axios.get('http://127.0.0.1:5000/allcampaigns',{headers:{'Authorization':\"Bearer \".concat(token)}});setCampaigns(response.data);}catch(error){console.error('Failed to fetch campaigns:',error);}};const showModal=()=>{setIsModalVisible(true);};const handleCancel=()=>{setIsModalVisible(false);};useEffect(()=>{if(!isModalVisible){fetchCampaigns();}},[isModalVisible]);return/*#__PURE__*/_jsx(\"div\",{children:user&&(user.role!=='участник'||user.role==!'наставник'||user.role==!'?наставник')?/*#__PURE__*/ // Отображаем раздел только если пользователь имеет нужную роль\n_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u041C\\u043E\\u0438 \\u0430\\u043A\\u0446\\u0438\\u0438\"}),/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:showModal,style:{marginBottom:'1rem'},children:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0430\\u043A\\u0446\\u0438\\u044E\"}),/*#__PURE__*/_jsx(Modal,{title:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u043D\\u043E\\u0432\\u0443\\u044E \\u0430\\u043A\\u0446\\u0438\\u044E\",open:isModalVisible,onCancel:handleCancel,footer:null,afterClose:fetchCampaigns,children:/*#__PURE__*/_jsx(CampaignForm,{})}),/*#__PURE__*/_jsx(CampaignList,{campaigns:campaigns})]}):/*#__PURE__*/_jsx(\"p\",{children:\"\\u0425\\u0423\\u0419\"})});};const CampaignList=_ref=>{let{campaigns}=_ref;return/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'space-between',flexWrap:'wrap',width:'100%'},children:campaigns.map(campaign=>/*#__PURE__*/_jsxs(\"div\",{style:{width:'300px',border:'1px solid #ccc',padding:'1rem',marginBottom:'1rem'},children:[/*#__PURE__*/_jsx(\"h3\",{children:campaign.title}),/*#__PURE__*/_jsx(\"p\",{children:campaign.description}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0414\\u0430\\u0442\\u0430 \\u043D\\u0430\\u0447\\u0430\\u043B\\u0430: \",new Date(campaign.start_date).toLocaleDateString(),\", \\u0414\\u0430\\u0442\\u0430 \\u043E\\u043A\\u043E\\u043D\\u0447\\u0430\\u043D\\u0438\\u044F:\",' ',new Date(campaign.end_date).toLocaleDateString()]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0421\\u0442\\u0430\\u0442\\u0443\\u0441: \",campaign.approval_status]}),campaign.image_url&&/*#__PURE__*/_jsx(\"img\",{src:\"http://127.0.0.1:5000\".concat(campaign.image_url),alt:campaign.title,style:{maxWidth:'100%'}})]},campaign.id))});};","map":{"version":3,"names":["React","useState","useEffect","Modal","Button","CampaignForm","axios","Cookies","jsx","_jsx","jsxs","_jsxs","Campaigns","isModalVisible","setIsModalVisible","campaigns","setCampaigns","user","setUser","fetchCampaigns","token","get","response","headers","concat","data","error","console","showModal","handleCancel","children","role","type","onClick","style","marginBottom","title","open","onCancel","footer","afterClose","CampaignList","_ref","display","justifyContent","flexWrap","width","map","campaign","border","padding","description","Date","start_date","toLocaleDateString","end_date","approval_status","image_url","src","alt","maxWidth","id"],"sources":["/Users/alexselyukov/Documents/napp/portal/src/pages/Personal/PersonalAreaContent/Campaigns/Campaigns.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Modal, Button } from 'antd';\nimport { CampaignForm } from './CampaignForm';\nimport axios from 'axios';\nimport Cookies from 'js-cookie';\n\n\nexport const Campaigns: React.FC = () => {\n    const [isModalVisible, setIsModalVisible] = useState(false);\n    const [campaigns, setCampaigns] = useState<any[]>([]);\n    const [user, setUser] = useState<any | null>(null)\n\n    const fetchCampaigns = async () => {\n        try {\n            const token = Cookies.get('token');\n            const response = await axios.get('http://127.0.0.1:5000/user', {\n                headers: {\n                    'Authorization': `Bearer ${token}`\n                }\n            });\n            setUser(response.data);  // Здесь устанавливаем данные о пользователе\n        } catch (error) {\n            console.error('Failed to fetch user:', error);\n        }\n        try {\n            const token = Cookies.get('token');\n            const response = await axios.get('http://127.0.0.1:5000/allcampaigns', {\n                headers: {\n                    'Authorization': `Bearer ${token}`\n                }\n            });\n            setCampaigns(response.data);\n        } catch (error) {\n            console.error('Failed to fetch campaigns:', error);\n        }\n    };\n\n    const showModal = () => {\n        setIsModalVisible(true);\n    };\n\n    const handleCancel = () => {\n        setIsModalVisible(false);\n    };\n\n    useEffect(() => {\n      if (!isModalVisible) {\n          fetchCampaigns();\n      }\n    }, [isModalVisible]);\n\n\n    return (\n        <div>\n            {user && (user.role !== 'участник' || user.role ==! 'наставник' || user.role ==! '?наставник') ? (  // Отображаем раздел только если пользователь имеет нужную роль\n                <div>\n                    <h2>Мои акции</h2>\n                        <Button type=\"primary\" onClick={showModal} style={{ marginBottom: '1rem' }}>\n                            Добавить акцию\n                        </Button>\n                    <Modal\n                        title=\"Добавить новую акцию\"\n                        open={isModalVisible}\n                        onCancel={handleCancel}\n                        footer={null}\n                        afterClose={fetchCampaigns}\n                    >\n                        <CampaignForm />\n                    </Modal>\n                    <CampaignList campaigns={campaigns} />\n                </div>\n            ) : (<p>ХУЙ</p>)}\n        </div>\n    );\n};\n\ninterface CampaignListProps {\n    campaigns: any[];\n}\n\nconst CampaignList: React.FC<CampaignListProps> = ({ campaigns }) => {\n    return (\n        <div style={{display: 'flex', justifyContent: 'space-between', flexWrap:'wrap', width: '100%'}}>\n            {campaigns.map((campaign) => (\n                <div key={campaign.id} style={{width: '300px', border: '1px solid #ccc', padding: '1rem', marginBottom: '1rem' }}>\n                    <h3>{campaign.title}</h3>\n                    <p>{campaign.description}</p>\n                    <p>\n                        Дата начала: {new Date(campaign.start_date).toLocaleDateString()}, Дата окончания:{' '}\n                        {new Date(campaign.end_date).toLocaleDateString()}\n                    </p>\n                    <p>\n                        Статус: {campaign.approval_status}\n                    </p>\n                    {campaign.image_url && <img src={`http://127.0.0.1:5000${campaign.image_url}`} alt={campaign.title} style={{ maxWidth: '100%' }} />}\n                </div>\n            ))}\n        </div>\n    );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}